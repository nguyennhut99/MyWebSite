@model IList<MyShop.Share.CartVM>

<h2>GIỎ HÀNG</h2>

@if (Model.Count > 0)
{
  decimal total = 0;
  int stt = 1;

  <table class="table">
    <tr>
      <th>#</th>
      <th>Sản phẩm</th>
      <th>Giá</th>
      <th>Số lượng</th>
      <th>Thành tiền</th>
      <th></th>
    </tr>
    @foreach (var cartitem in Model)
    {
      var thanhtien = cartitem.OrderQty * cartitem.ProductPrice;
      total += thanhtien;

      @* <tr>
        <form method="POST">
        <td>@(stt++)</td>
        <td>@cartitem.ProductName</td>
        <td>@(cartitem.ProductPrice.ToString("n0"))</td>
        <td><input asp-for="@cartitem.OrderQty" id="@($"quantity-{cartitem.Id}")"/></td>
        <td>@(thanhtien.ToString("n0"))</td>

        <td>
        <button class="btn btn-success updatecartitem"
        data-cartId="@cartitem.Id">Cập nhật</button>

        <a class="btn btn-danger" asp-controller="Cart" asp-action="RemoveCart" asp-route-cartId="@cartitem.Id">
        Xóa
        </a>
        </td>
        </form>
        </tr> *@
      <tr>
        @using (Html.BeginForm("UpdateCart", "Cart"))
        {
          <td>@(stt++)</td>
          <td>@cartitem.ProductName</td>
          <td>@(cartitem.ProductPrice.ToString("n0"))</td>
          <input type="hidden" name="id" value="@cartitem.Id">
          <td><input name="quantity" asp-for="@cartitem.OrderQty" /></td>
          <td>@(thanhtien.ToString("n0"))</td>

          <td>
            <button type="submit" class="btn btn-success updatecartitem" data-cartId="@cartitem.Id">Cập nhật</button>

            <a class="btn btn-danger" asp-controller="Cart" asp-action="RemoveCart" 
            asp-route-cartId="@cartitem.Id"> Xóa
            </a>
          </td>
        }
      </tr>
    }
    <tr>
      <td colspan="4" class="text-right">Tổng tiền</td>
      <td>@(total.ToString("n0"))</td>
      <td></td>
    </tr>
  </table>

  <a asp-controller="Product" asp-action="Checkout" class="btn btn-success">Gửi đơn hàng</a>

  @* @section Scripts {
    <script>
    $(document).ready(function () {
    $(".updatecartitem").click(function (event) {
    event.preventDefault();
    var cartid = $(this).attr("data-cartId");
    var quantity = $("#quantity-" + cartid).val();
    $.ajax({
    type: "POST",
    url:"@Url.RouteUrl("updateCart")",
    data: {
    productid: productid,
    quantity:quantity
    },
    success: function (result) {
    window.location.href = "@Url.RouteUrl("Cart")";
    }
    });
    });
    });
    </script>
    } *@
}
else
{
  <p class="alert alert-danger">Giỏ hàng trống</p>
}